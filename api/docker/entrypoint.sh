#!/bin/sh

source /docker_secrets_to_env_var_expand.sh

java $JAVA_OPTS -Dspring.profiles.active=$ENVIRONMENT -Dserver.port=$PORT -Dmicroblink.licensee="$LICENSEE" -Dmicroblink.licenseKey="$LICENSE_KEY$LICENCE_KEY" -Dmicroblink.ping.isEnabled=$PING_IS_ENABLED -Dmicroblink.ping.period.tasks=$PING_PERIOD_TASKS -Dmicroblink.isMlsUploadEnabled=$MLS_IS_ENABLED -Dmicroblink.id.enabled=$MICROBLINK_IDENTITY_IS_ENABLED -Dmicroblink.id.serverURL="$MICROBLINK_IDENTITY_SERVER_URL" -Dmicroblink.id.consumerAuthenticationHeader="$MICROBLINK_IDENTITY_CONSUMER_AUTHENTICATION_HEADER" -Dmicroblink.id.isEnabledAndAuthorizationIsMissing.isMaskingResultsEnabled=$MICROBLINK_IDENTITY_IS_ENABLED_AND_AUTHORIZATION_IS_MISSING_IS_MASKING_RESULTS_ENABLED -Dmicroblink.id.consumeBatch.whenAccumulatedExecutionsAreMoreThan=$MICROBLINK_IDENTITY_CONSUME_BATCH_WHEN_ACCUMULATED_EXECUTIONS_ARE_MORE_THAN -Dmicroblink.id.consumeBatch.afterHowManySecondsStartNewConsuming=$MICROBLINK_IDENTITY_CONSUME_BATCH_WHEN_HOW_MANY_SECONDS_SINCE_LAST_CONSUMING -Dmicroblink.maxVisibleMaskedCharactersPerProperty=$MAX_VISIBLE_MASKED_CHARACTERS_PER_PROPERTY -Dmicroblink.maxVisibleMaskedPercentageOfProperty=$MAX_VISIBLE_MASKED_PERCENTAGE_OF_PROPERTY -Dmicroblink.wrapperPath="/wrapper/wrapper" -Dmicroblink.resourcesPath="/wrapper/resources" -Dmicroblink.defaultNumberOfWorkers=$DEFAULT_NUMBER_OF_WORKERS -Dmicroblink.taskCounterLimitWhenWorkerShouldBeStopped=$TASK_COUNTER_LIMIT_WHEN_WORKER_SHOULD_BE_STOPPED -Dmicroblink.minutesCounterLimitWhenWorkerShouldBeStopped=$MINUTES_COUNTER_LIMIT_WHEN_WORKER_SHOULD_BE_STOPPED -Dmicroblink.executionQueueCapacity=$EXECUTION_QUEUE_CAPACITY -Dmicroblink.executionTimeoutInSeconds=$EXECUTION_TIMEOUT_IN_SECONDS -Dmicroblink.imageSizeLimitInMB=$MICROBLINK_IMAGE_SIZE_LIMIT_IN_MB -Djava.security.egd=file:/dev/./urandom -jar /app.jar $APP_PARAMS